<div class="bg-gray-200 p-4 rounded-lg flex justify-center items-center animate-fade-in">
    <div
        class="w-[390px] h-[844px] bg-white text-slate-800 rounded-[40px] shadow-2xl border-8 border-slate-300 overflow-hidden flex flex-col">
        @switch (previewState()) {
        @case ('home') {
        <div class="flex-1 flex flex-col bg-slate-50 relative overflow-hidden">
            <div class="h-52 w-full relative overflow-hidden">
                <img [src]="editorForm.get('coverImageUrl')?.value"
                    class="w-full h-full object-cover animate-ken-burns origin-center">
                <div class="absolute inset-0 bg-gradient-to-b from-black/30 to-transparent"></div>
                <div class="absolute bottom-4 left-6 text-white">
                    <p class="font-light text-sm uppercase tracking-widest mb-1">{{ 'BOOKLET.welcome_to' | translate }}
                    </p>
                    <h2 class="text-2xl font-bold leading-tight shadow-black drop-shadow-md">{{ propertyName() }}</h2>
                </div>
            </div>

            <div class="relative flex-1 overflow-y-auto pb-4">
                <div class="absolute -top-6 w-full h-8 bg-slate-50 rounded-t-3xl z-10"></div>
                <div class="bg-slate-50 min-h-full pt-4 px-4 relative z-0">

                    @if (enabledWidgetIds().length > 0) {
                    <div class="mb-6">
                        <p class="text-center font-semibold text-slate-400 mb-3 text-xs uppercase tracking-wider">
                            {{ 'BOOKLET.direct_infos' | translate }}
                        </p>
                        <div class="grid grid-cols-4 gap-2">
                            @for(widgetId of enabledWidgetIds(); track widgetId) {
                            @if (getWidgetLink(widgetId); as link) {
                            <a [href]="link" target="_blank"
                                class="bg-white p-2 rounded-xl shadow-sm border border-slate-100 flex flex-col items-center justify-center h-20 shadow-[0_4px_6px_-1px_rgba(0,0,0,0.1)] transition-transform active:scale-95 relative overflow-hidden hover:border-blue-300">
                                <span class="text-xl mb-1">{{ getWidgetIcon(widgetId) }}</span>
                                <span
                                    class="text-[8px] font-bold text-slate-400 uppercase tracking-wide truncate w-full text-center">{{
                                    getWidgetName(widgetId) | translate }}</span>
                                <span class="text-[10px] font-bold text-slate-800 mt-0.5 truncate w-full text-center">{{
                                    getWidgetValue(widgetId) }}</span>
                            </a>
                            } @else {
                            <div
                                class="bg-white p-2 rounded-xl shadow-sm border border-slate-100 flex flex-col items-center justify-center h-20 shadow-[0_4px_6px_-1px_rgba(0,0,0,0.1)] transition-transform active:scale-95 relative overflow-hidden">
                                <span class="text-xl mb-1">{{ getWidgetIcon(widgetId) }}</span>
                                <span
                                    class="text-[8px] font-bold text-slate-400 uppercase tracking-wide truncate w-full text-center">{{
                                    getWidgetName(widgetId) | translate }}</span>
                                <span class="text-[10px] font-bold text-slate-800 mt-0.5 truncate w-full text-center">{{
                                    getWidgetValue(widgetId) }}</span>
                            </div>
                            }
                            }
                        </div>
                    </div>
                    }

                    <p class="text-center font-semibold text-slate-400 mb-4 text-xs uppercase tracking-wider">
                        {{ 'BOOKLET.house_guide' | translate }}
                    </p>
                    <div class="grid grid-cols-4 gap-x-2 gap-y-6 text-center">
                        @for(section of activeSections(); track section.id) {
                        <button (click)="showSection(section.id)"
                            class="flex flex-col items-center justify-start space-y-2 text-slate-700 hover:text-blue-600 transition-colors group">
                            <div
                                class="w-16 h-16 flex items-center justify-center border border-slate-200 bg-white rounded-2xl shadow-lg shadow-slate-200 group-hover:shadow-blue-200 group-hover:border-blue-200 transition-all">
                                <div class="w-7 h-7" [innerHTML]="section.icon"></div>
                            </div>
                            <span class="text-[10px] font-bold uppercase tracking-tight">{{ section.previewTitle |
                                translate
                                }}</span>
                        </button>
                        }
                    </div>

                    @if(propertyPhotos().length > 0) {
                    <div class="mt-8 mb-4">
                        <p class="text-center font-semibold text-slate-400 mb-4 text-xs uppercase tracking-wider">
                            {{ 'BOOKLET.gallery' | translate }}
                        </p>
                        <div class="flex space-x-3 overflow-x-auto pb-2 no-scrollbar">
                            @for(photo of propertyPhotos(); track $index) {
                            <div class="flex-shrink-0 w-28 h-28 rounded-xl overflow-hidden shadow-md">
                                <img [src]="photo.url" class="w-full h-full object-cover">
                            </div>
                            }
                        </div>
                    </div>
                    }
                </div>
            </div>
        </div>
        }
        @default {
        @if(currentSection(); as section) {
        <div class="flex-1 flex flex-col bg-white" [formGroup]="editorForm">
            <div class="bg-blue-50 p-4 text-blue-900 border-b border-blue-100 flex-shrink-0">
                <button (click)="showHome()" class="mb-3">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
                        stroke="currentColor" class="w-7 h-7">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
                    </svg>
                </button>
                <div class="flex space-x-4 overflow-x-auto pb-2 no-scrollbar">
                    @for(s of activeSections(); track s.id) {
                    <button (click)="showSection(s.id)"
                        class="flex-shrink-0 flex flex-col items-center justify-start space-y-1 text-blue-900 transition-opacity"
                        [class.opacity-50]="s.id !== section.id">
                        <div
                            class="w-10 h-10 flex items-center justify-center border border-blue-200 rounded-full bg-white/50 shadow-sm shadow-blue-100">
                            <div class="w-5 h-5 text-blue-900" [innerHTML]="s.icon"></div>
                        </div>
                    </button>
                    }
                </div>
            </div>
            <div class="flex-1 overflow-y-auto p-6" [formGroupName]="section.formGroupName">
                <h2 class="text-3xl font-bold text-blue-900 mb-6">{{ section.previewTitle | translate }}</h2>
                @switch(section.id) {
                @case('departure') {
                <div class="space-y-4 text-slate-700">
                    <h4 class="font-bold">{{ 'BOOKLET.departure_heading' | translate }}</h4>
                    <p>{{ 'BOOKLET.departure_deadline' | translate }} <strong>{{
                            editorForm.get('departure.checkoutTime')?.value }}</strong>.</p>
                    @if(isValidContent(editorForm.get('departure.cleaningInstructions')?.value)) { <h4
                        class="font-bold mt-4">{{ 'BOOKLET.departure_before' | translate }}</h4>
                    <p class="whitespace-pre-wrap">{{ editorForm.get('departure.cleaningInstructions')?.value }}</p> }
                    @if(isValidContent(editorForm.get('departure.linenManagement')?.value)) { <h4
                        class="font-bold mt-4">{{ 'BOOKLET.departure_linen' | translate }}</h4>
                    <p class="whitespace-pre-wrap">{{ editorForm.get('departure.linenManagement')?.value }}</p> }
                    @if(isValidContent(editorForm.get('departure.keyReturn')?.value)) { <h4 class="font-bold mt-4">{{
                        'BOOKLET.departure_keys' | translate }}
                    </h4>
                    <p class="whitespace-pre-wrap">{{ editorForm.get('departure.keyReturn')?.value }}</p> }
                </div>
                }
                @default {
                <div class="space-y-6 text-slate-700">
                    @for (control of getGroupControls(section.formGroupName); track control) {
                    @if (isValidContent(editorForm.get(section.formGroupName + '.' + control)?.value)) {
                    <div>
                        <h4 class="font-bold text-slate-800">{{ getLabelForControl(section.id, control) | translate }}
                        </h4>
                        <p class="whitespace-pre-wrap text-sm mt-1">{{ editorForm.get(section.formGroupName + '.' +
                            control)?.value }}</p>
                        @if (editorForm.get(section.formGroupName + '.' + control + '_pdf')?.value) {
                        <div class="mt-2"><a
                                [href]="editorForm.get(section.formGroupName + '.' + control + '_pdf')?.value"
                                target="_blank"
                                class="inline-flex items-center text-xs font-semibold text-blue-600 bg-blue-50 px-2 py-1 rounded border border-blue-100 hover:bg-blue-100"><svg
                                    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"
                                    class="w-3 h-3 mr-1">
                                    <path fill-rule="evenodd"
                                        d="M15.621 4.379a3 3 0 0 0-4.242 0l-7 7a3 3 0 0 0 4.241 4.243h.001l.497-.5a.75.75 0 0 1 1.064 1.057l-.498.501-.002.002a4.5 4.5 0 0 1-6.364-6.364l7-7a4.5 4.5 0 0 1 6.368 6.36l-3.455 3.553A2.625 2.625 0 1 1 9.52 9.52l3.45-3.451a.75.75 0 1 1 1.061 1.06l-3.45 3.451a1.125 1.125 0 0 0 1.587 1.595l3.454-3.553a3 3 0 0 0 0-4.242Z"
                                        clip-rule="evenodd" />
                                </svg>{{ 'BOOKLET.see_manual' | translate }}</a></div>
                        }
                    </div>
                    }
                    }
                    @if (isSectionEmpty(section.formGroupName)) { <p class="italic text-slate-400">{{ 'BOOKLET.no_info'
                        | translate }}</p> }
                </div>
                }
                }
            </div>
        </div>
        }
        }
        }
    </div>
</div>