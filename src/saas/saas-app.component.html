<!-- Global Background Layer -->
<div class="fixed inset-0 z-0">
    <div class="absolute inset-0 bg-cover bg-center"
        style="background-image: url('https://filedn.eu/ly7XXkiJCqgYRqPEHDEShdQ/Pascal/host/background_app_hostweb.jpg');">
    </div>
    <!-- Overlay sombre pour lisibilité et ambiance luxe -->
    <div class="absolute inset-0 bg-black/60 backdrop-blur-[2px]"></div>
</div>

<!-- Main Layout Container (Z-10 to sit above background) -->
<div class="relative z-10 flex h-screen overflow-hidden font-sans">

    <!-- Sidebar (Verticale fixe à gauche) -->
    <saas-sidebar class="flex-shrink-0 h-full" [activeView]="activeView()" [userPlan]="userPlan()"
        [userName]="userName()" [userRole]="userRole()" [properties]="properties()" (viewChange)="onViewChange($event)"
        (logout)="onLogout()">
    </saas-sidebar>

    <!-- Main Content Area -->
    <div class="flex-1 flex flex-col min-w-0 bg-transparent transition-all duration-500">

        <!-- Top Header (Transparent Glass) -->
        <header
            class="bg-white/5 border-b border-white/10 px-8 h-16 flex items-center justify-between flex-shrink-0 backdrop-blur-md shadow-sm">
            <h2 class="text-xl font-bold text-white tracking-tight flex items-center gap-2">
                @if(activeView().propertyName) {
                <a (click)="goToPropertyHome()"
                    class="hover:text-[#D4AF37] cursor-pointer transition-colors flex items-center gap-2"
                    title="Aller à la gestion de la propriété">
                    <span class="opacity-50 font-light text-sm uppercase tracking-wider">Propriété :</span>
                    <span class="text-shadow-sm">{{ activeView().propertyName }}</span>
                </a>
                } @else {
                <span>{{ activeView().title }}</span>
                }
            </h2>
        </header>

        <!-- Horizontal Angles Menu (Floating Pill Style) -->
        @if (userRole() !== 'admin') {
        <div class="py-4 z-30 flex justify-center flex-shrink-0">
            <saas-angles-menu [activeView]="activeView()" (viewChange)="onViewChange($event)"></saas-angles-menu>
        </div>
        }

        <!-- Scrollable Content -->
        <main class="flex-1 overflow-y-auto p-8 custom-scrollbar">
            <!-- Container centered for large screens -->
            <div class="max-w-7xl mx-auto">
                @if (isAngleView()) {
                <saas-angle-view [view]="activeView()" [userPlan]="userPlan()"></saas-angle-view>
                } @else {
                @switch (activeView().id) {
                @case ('dashboard') {
                <saas-dashboard-view [userName]="userName()" [reportData]="reportData()"></saas-dashboard-view>
                }
                @case ('global-dashboard') {
                <saas-global-dashboard-view></saas-global-dashboard-view>
                }
                @case ('create-property') {
                <div
                    class="max-w-2xl mx-auto bg-slate-900/80 backdrop-blur-xl p-8 rounded-2xl shadow-2xl border border-white/10">
                    <h2 class="text-2xl font-bold mb-6 text-white">Ajouter une nouvelle propriété</h2>
                    <form [formGroup]="createPropertyForm" (ngSubmit)="submitCreateProperty()">
                        <div class="mb-6">
                            <label for="propName" class="block text-sm font-medium text-slate-300 mb-2">Nom de la
                                propriété</label>
                            <input type="text" id="propName" formControlName="name"
                                class="w-full px-4 py-3 border border-white/20 rounded-lg focus:ring-[#D4AF37] focus:border-[#D4AF37] bg-white/10 text-white placeholder-slate-400"
                                placeholder="Ex: Appartement Vue Mer">
                            <p class="text-xs text-slate-400 mt-2">Ce nom sera utilisé pour identifier votre bien dans
                                le tableau de bord.</p>
                        </div>
                        <div class="flex justify-end">
                            <button type="submit" [disabled]="createPropertyForm.invalid"
                                class="px-6 py-3 bg-[#D4AF37] text-slate-900 font-bold rounded-lg hover:bg-yellow-500 disabled:bg-slate-600 disabled:text-slate-400 disabled:cursor-not-allowed transition-colors shadow-lg">
                                Créer la propriété
                            </button>
                        </div>
                    </form>
                </div>
                }
                @case ('wheel') {
                <saas-host-wheel-view [initialScores]="scores()" [reportData]="reportData()"
                    [contextData]="contextData()">
                </saas-host-wheel-view>
                }
                @case ('manage-property') {
                <saas-property-view [view]="activeView()"></saas-property-view>
                }
                @case ('property-data') {
                <saas-property-data-view [view]="activeView()"></saas-property-data-view>
                }
                @case ('welcome-booklet') {
                <saas-welcome-booklet-view [propertyName]="activeView().propertyName!"></saas-welcome-booklet-view>
                }
                @case ('widget-library') {
                <saas-widget-library-view [propertyName]="activeView().propertyName!"></saas-widget-library-view>
                }
                @case ('vocal-concierge') {
                <saas-vocal-concierge-view [propertyName]="activeView().propertyName!"></saas-vocal-concierge-view>
                }
                @case ('training') {
                <saas-training-view></saas-training-view>
                }
                @case ('account') {
                <saas-host-info-view></saas-host-info-view>
                }
                @case ('admin-users') {
                <saas-admin-users-view></saas-admin-users-view>
                }
                @default {
                <div
                    class="p-12 text-center text-slate-400 bg-white/5 rounded-xl border border-dashed border-white/10 backdrop-blur-sm">
                    <h2 class="text-xl font-bold mb-2 text-white">Bienvenue !</h2>
                    <p>Veuillez sélectionner une option dans le menu pour commencer.</p>
                </div>
                }
                }
                }
            </div>
        </main>
    </div>
</div>