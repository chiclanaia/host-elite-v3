<!-- Global Background Layer -->
<div class="fixed inset-0 z-0">
    <div class="absolute inset-0 bg-cover bg-center"
        [style.backgroundImage]="'url(https://filedn.eu/ly7XXkiJCqgYRqPEHDEShdQ/Pascal/host/background_app_hostweb.jpg)'">
    </div>
    <!-- Overlay sombre pour lisibilité et ambiance luxe -->
    <div class="absolute inset-0 bg-black/60 backdrop-blur-[2px]"></div>
</div>

<!-- Main Layout Container (Z-10 to sit above background) -->
<div class="relative z-10 flex h-screen overflow-hidden font-sans">

    <!-- Sidebar (Verticale fixe à gauche) -->
    <saas-sidebar class="flex-shrink-0 h-full" [activeView]="activeView()" [userPlan]="userPlan()"
        [userName]="userName()" [userRole]="userRole()" [userAvatar]="userAvatar()" [properties]="properties()"
        (viewChange)="onViewChange($event)" (openSettings)="openProfileModal()" (logout)="onLogout()">
    </saas-sidebar>

    <!-- Main Content Area -->
    <div class="flex-1 flex flex-col min-w-0 bg-transparent transition-all duration-500">

        <!-- Top Header (Transparent Glass) -->
        <header
            class="bg-white/5 border-b border-white/10 px-8 h-16 flex items-center justify-between flex-shrink-0 backdrop-blur-md shadow-sm">
            <h2 class="text-xl font-bold text-white tracking-tight flex items-center gap-2">
                @if(activeView().propertyName) {
                <a (click)="goToPropertyHome()"
                    class="hover:text-[#D4AF37] cursor-pointer transition-colors flex items-center gap-2"
                    title="Aller à la gestion de la propriété">
                    <span class="opacity-50 font-light text-sm uppercase tracking-wider">{{ 'WELCOME.Address' |
                        translate }} :</span>
                    <span class="text-shadow-sm">{{ activeView().propertyName }}</span>
                </a>
                } @else {
                <span>{{ activeView().title }}</span>
                }
            </h2>

            <!-- Header Actions -->
            <div class="flex items-center gap-4">
                <!-- DEBUG: Tier Selector -->
                <div class="hidden md:flex items-center bg-indigo-500/10 rounded-lg px-2 border border-indigo-500/20">
                    <span class="text-xs text-indigo-300 font-bold mr-2 uppercase">Simulate:</span>
                    <select #planSelect (change)="onPlanChange(planSelect.value)" [value]="userPlan()"
                        aria-label="Tier Selector"
                        class="bg-transparent text-white text-xs font-mono font-bold py-1 focus:ring-0 border-none outline-none cursor-pointer">
                        @for(tier of availableTiers; track tier) {
                        <option [value]="tier" class="bg-slate-800 text-white">{{ tier }}</option>
                        }
                    </select>
                </div>

                <!-- Global Language Switcher -->
                @if (store.showLanguageSwitcher()) {
                <div class="flex bg-white/10 backdrop-blur-md rounded-lg p-1 border border-white/10">
                    <button (click)="translationService.setLanguage('en')"
                        [class.bg-white]="translationService.currentLang() === 'en'"
                        [class.text-slate-900]="translationService.currentLang() === 'en'"
                        [class.text-white]="translationService.currentLang() !== 'en'"
                        class="px-3 py-1 text-xs rounded transition-all font-bold hover:bg-white/20">EN</button>
                    <button (click)="translationService.setLanguage('fr')"
                        [class.bg-white]="translationService.currentLang() === 'fr'"
                        [class.text-slate-900]="translationService.currentLang() === 'fr'"
                        [class.text-white]="translationService.currentLang() !== 'fr'"
                        class="px-3 py-1 text-xs rounded transition-all font-bold hover:bg-white/20">FR</button>
                    <button (click)="translationService.setLanguage('es')"
                        [class.bg-white]="translationService.currentLang() === 'es'"
                        [class.text-slate-900]="translationService.currentLang() === 'es'"
                        [class.text-white]="translationService.currentLang() !== 'es'"
                        class="px-3 py-1 text-xs rounded transition-all font-bold hover:bg-white/20">ES</button>
                </div>
                }

                <!-- Notification Bell -->
                <saas-notification-bell></saas-notification-bell>
            </div>
        </header>

        <!-- Horizontal Angles Menu (Floating Pill Style) -->
        @if (userRole() !== 'admin') {
        <div class="py-4 z-30 flex justify-center flex-shrink-0">
            <saas-phases-menu [activeView]="activeView()" (viewChange)="onViewChange($event)"></saas-phases-menu>
        </div>
        }

        <!-- Scrollable Content -->
        <main class="flex-1 overflow-y-auto p-8 custom-scrollbar">
            <!-- Container centered for large screens -->
            <div class="max-w-7xl mx-auto">
                @if (isAngleView()) {
                <saas-angle-view [view]="activeView()" [userPlan]="userPlan()"></saas-angle-view>
                } @else {
                @switch (activeView().id) {
                @case ('dashboard') {
                <saas-dashboard-view [userName]="userName()" [reportData]="reportData()"></saas-dashboard-view>
                }
                @case ('global-dashboard') {
                <saas-global-dashboard-view></saas-global-dashboard-view>
                }
                @case ('create-property') {
                <div
                    class="max-w-2xl mx-auto bg-slate-900/80 backdrop-blur-xl p-8 rounded-2xl shadow-2xl border border-white/10">
                    <h2 class="text-2xl font-bold mb-6 text-white">Ajouter une nouvelle propriété</h2>
                    <form [formGroup]="createPropertyForm" (ngSubmit)="submitCreateProperty()">
                        <div class="mb-6">
                            <label for="propName" class="block text-sm font-medium text-slate-300 mb-2">Nom de la
                                propriété</label>
                            <input type="text" id="propName" formControlName="name"
                                class="w-full px-4 py-3 border border-white/20 rounded-lg focus:ring-[#D4AF37] focus:border-[#D4AF37] bg-white/10 text-white placeholder-slate-400"
                                placeholder="Ex: Appartement Vue Mer">
                            <p class="text-xs text-slate-400 mt-2">Ce nom sera utilisé pour identifier votre bien dans
                                le tableau de bord.</p>
                        </div>
                        <div class="flex justify-end">
                            <button type="submit" [disabled]="createPropertyForm.invalid"
                                class="px-6 py-3 bg-[#D4AF37] text-slate-900 font-bold rounded-lg hover:bg-yellow-500 disabled:bg-slate-600 disabled:text-slate-400 disabled:cursor-not-allowed transition-colors shadow-lg">
                                Créer la propriété
                            </button>
                        </div>
                    </form>
                </div>
                }
                @case ('wheel') {
                <saas-host-wheel-view [initialScores]="scores()" [reportData]="reportData()"
                    [contextData]="contextData()">
                </saas-host-wheel-view>
                }
                @case ('manage-property') {
                <saas-property-view [view]="activeView()"></saas-property-view>
                }
                @case ('property-calendar') {
                <app-calendar-tool [propertyDetails]="selectedPropertyDetails()"
                    [filterToInternal]="false"></app-calendar-tool>
                }
                @case ('my-calendars') {
                <app-calendar-tool [propertyDetails]="selectedPropertyDetails()" [filterToInternal]="true"
                    [isGlobal]="true"></app-calendar-tool>
                }

                @case ('welcome-booklet') {
                <saas-welcome-booklet-view [propertyName]="activeView().propertyName!"></saas-welcome-booklet-view>
                }
                @case ('widget-library') {
                <saas-widget-library-view [propertyName]="activeView().propertyName!"></saas-widget-library-view>
                }
                @case ('vocal-concierge') {
                <saas-vocal-concierge-view [propertyName]="activeView().propertyName!"></saas-vocal-concierge-view>
                }
                @case ('profit-calculator') {
                <saas-profitability-view></saas-profitability-view>
                }
                @case ('training') {
                <saas-training-view></saas-training-view>
                }
                @case ('account') {
                <saas-host-info-view></saas-host-info-view>
                }
                @case ('admin-users') {
                <saas-admin-users-view></saas-admin-users-view>
                }
                @case ('admin-debug') {
                <app-admin-debug-view></app-admin-debug-view>
                }
                @default {
                <div
                    class="p-12 text-center text-slate-400 bg-white/5 rounded-xl border border-dashed border-white/10 backdrop-blur-sm">
                    <h2 class="text-xl font-bold mb-2 text-white">Bienvenue !</h2>
                    <p>Veuillez sélectionner une option dans le menu pour commencer.</p>
                </div>
                }
                }
                }
            </div>
        </main>
    </div>
</div>

<!-- Global Overlays & Modals -->
@if (notifService.isModalOpen()) {
<saas-notification-center class="relative z-[9999]"
    (close)="notifService.isModalOpen.set(false)"></saas-notification-center>
}

@if (isProfileModalOpen()) {
<saas-profile-modal></saas-profile-modal>
}